# ~/.tmux.conf

unbind C-b
set -g prefix `
bind ` send-prefix

set -g base-index 1
set -g pane-base-index 1
set -g renumber-windows on
set -g repeat-time 1000
set -g history-limit 10000

bind v split-window -v -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
bind h split-window -h -c "#{pane_current_path}"
bind | split-window -h -c "#{pane_current_path}"
bind f resize-pane -Z

# Smart pane navigation with vim-like bindings
bind -n C-h select-pane -L
bind -n C-j select-pane -D
bind -n C-k select-pane -U
bind -n C-l select-pane -R

# Pane resizing with arrow keys
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Quick window switching
bind -n M-1 select-window -t 1
bind -n M-2 select-window -t 2
bind -n M-3 select-window -t 3
bind -n M-4 select-window -t 4
bind -n M-5 select-window -t 5

# Synchronize panes toggle
bind S setw synchronize-panes \; display-message "Synchronize panes: #{?pane_synchronized,ON,OFF}"

# sesh session management
bind -N "last-session (via sesh) " L run-shell "sesh last"

bind-key "T" run-shell "sesh connect \"\$(
  sesh list --icons | fzf-tmux -p 80%,70% \
    --no-sort --ansi --border-label ' sesh ' --prompt '‚ö°  ' \
    --header '  ^a all ^t tmux ^g configs ^x zoxide ^d tmux kill ^f find' \
    --bind 'tab:down,btab:up' \
    --bind 'ctrl-a:change-prompt(‚ö°  )+reload(sesh list --icons)' \
    --bind 'ctrl-t:change-prompt(ü™ü  )+reload(sesh list -t --icons)' \
    --bind 'ctrl-g:change-prompt(‚öôÔ∏è  )+reload(sesh list -c --icons)' \
    --bind 'ctrl-x:change-prompt(üìÅ  )+reload(sesh list -z --icons)' \
    --bind 'ctrl-f:change-prompt(üîé  )+reload(fd -H -d 2 -t d -E .Trash . ~)' \
    --bind 'ctrl-d:execute(tmux kill-session -t {2..})+change-prompt(‚ö°  )+reload(sesh list --icons)' \
    --preview-window 'right:55%' \
    --preview 'sesh preview {}'
)\""

bind-key x kill-pane # skip "kill-pane 1? (y/n)" prompt
set -g detach-on-destroy off  # don't exit from tmux when closing a session

setw -g mode-keys vi

# Copy mode keybindings
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind -T copy-mode-vi y send-keys -X copy-selection-and-cancel
bind -T copy-mode-vi Escape send-keys -X cancel
bind -T copy-mode-vi H send-keys -X start-of-line
bind -T copy-mode-vi L send-keys -X end-of-line

# Copy to system clipboard (Linux/WSL)
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel 'xclip -in -selection clipboard'
bind -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel 'xclip -in -selection clipboard'

# Options to make tmux more pleasant
set -g mouse on
set -g default-terminal "screen-256color"
set -ga terminal-overrides ",xterm-256color:Tc"

# Status bar position
set-option -g status-position bottom
set -g escape-time 0

# Enhanced pane styling with Catppuccin colors
set -g pane-border-style "fg=#{@thm_surface_0}"
set -g pane-active-border-style "fg=#{@thm_lavender},bg=default"
set -g pane-border-lines heavy
set -g pane-border-format " #{?pane_active,#[fg=#{@thm_peach}] ,}#{pane_index} #{pane_current_command} "
set -g pane-border-status top

# Automatic window naming based on current directory
set-option -g status-interval 2
set-option -g automatic-rename on
# Show directory name when in bash, or "command:directory" for other programs
set-option -g automatic-rename-format '#{?#{==:#{pane_current_command},bash},#{b:pane_current_path},#{pane_current_command}:#{b:pane_current_path}}'

# Enhanced status line configuration
set -g status-right-length 200
set -g status-left-length 100
set -g status-interval 1

# =====================================
# Catppuccin Theme Configuration
# =====================================

# Configure the catppuccin theme
set -g @catppuccin_flavor "mocha" # latte, frappe, macchiato or mocha

# Window configuration
set -g @catppuccin_window_status_style "rounded"
set -g @catppuccin_window_left_separator "‚ñà"
set -g @catppuccin_window_right_separator "‚ñà "
set -g @catppuccin_window_middle_separator " ‚ñà"
set -g @catppuccin_window_number_position "right"
set -g @catppuccin_window_default_fill "number"
set -g @catppuccin_window_default_text "#W"
set -g @catppuccin_window_current_fill "number"
set -g @catppuccin_window_current_text "#W"

# Status bar modules configuration
set -g @catppuccin_status_modules_right "directory user host session date_time battery"
set -g @catppuccin_status_modules_left ""
set -g @catppuccin_status_left_separator  " "
set -g @catppuccin_status_right_separator ""
set -g @catppuccin_status_fill "icon"
set -g @catppuccin_status_connect_separator "no"
set -g @catppuccin_status_background "default"

# Directory module
set -g @catppuccin_directory_text "#{pane_current_path}"

# Date and time
set -g @catppuccin_date_time_text "%Y-%m-%d %H:%M:%S"

# =====================================
# Plugins Configuration
# =====================================

# Configuration for tmux-mode-indicator
set -g @mode_indicator_prefix_prompt ' WAIT '
set -g @mode_indicator_prefix_mode_style 'bg=blue,fg=black'
set -g @mode_indicator_copy_prompt ' COPY '
set -g @mode_indicator_copy_mode_style 'bg=yellow,fg=black'
set -g @mode_indicator_sync_prompt ' SYNC '
set -g @mode_indicator_sync_mode_style 'bg=red,fg=black'
set -g @mode_indicator_empty_prompt ' TMUX '
set -g @mode_indicator_empty_mode_style 'bg=cyan,fg=black'

# Configuration for tmux-fzf
set -g @tmux-fzf-launch-key 'F'
# Add fzf to PATH for tmux-fzf
set-environment -g PATH "$HOME/.fzf/bin:$PATH"

# Configuration for tmux-autoreload
set -g @tmux-autoreload-configs '~/.config/tmux/tmux.conf'
set -g @tmux-autoreload-quiet 1

# Claude popup windows
bind C display-popup -E -w 80% -h 80% "claude"
bind R display-popup -E -w 80% -h 80% "claude --continue"

# Generic popup for running commands with padding
bind p command-prompt -p "Command:" "display-popup -E -w 90% -h 90% '%%'"

# =====================================
# TPM Plugin Management
# =====================================

# Set TPM environment variable
set-environment -g TMUX_PLUGIN_MANAGER_PATH '~/.config/tmux/plugins/'

# List of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'catppuccin/tmux#v2.1.3' # Use specific version for stability
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'tmux-plugins/tmux-copycat'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'tmux-plugins/tmux-battery'
set -g @plugin 'MunifTanjim/tmux-mode-indicator'
set -g @plugin 'sainnhe/tmux-fzf'
set -g @plugin 'jonmosco/kube-tmux'
set -g @plugin 'b0o/tmux-autoreload'

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.config/tmux/plugins/tpm/tpm'